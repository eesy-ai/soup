# SOUP #

Sleep data cOpilot for accUrate hyPnogram labeling

## Summary ##
This repository is for developing a tool that analyze pair  of signals (biomedical signal-hypnogram) with state-of-the-art conditions. The objective is to provide feedback to health professionals or researches to improve the reliability of sleep stage annotations generated by both automated tools and single expert annotations. 

├── soup 

│   ├── soup: Central class of the framework, providing essential functionalities and attributes. Acting as a parent base class, it manages configuration settings (config), conducts condition validations, performs statistical analysis (via the Statistics class), and handles output visualization (via the Display class).

│   ├── Statistics: Tesponsible for conducting statistical analyses on the data, implementing methods to compare datasets and test equality between two distributions on average.

│   ├──  Display: Manages output logs and visualization, presenting validation results and offering functionality for clustering patients based on output data.

│   ├──  config: File that contains all the configuration needed for the analysis. It must contain:
   * STAGES dictionary, containig the code stage-number of the dataset. 
   * Conditions to be check. This, is further explained in the section **Scalability**

│   ├──  AC, HRFreq, HRTime: Auxiliary classes to implement specific methods of each particular signal. 

├── examples
│   ├── mesa: contains an example using MESA dataset. An in-deepth explanation can be found in the paper were this tool is presented. It is necessary to download the raw data from MESA datset to use this example.
│   ├── plug&play: contains a ready-to-use example. 
## Dependencies ##

* matplotlib >= 3.7
* pandas >= 2.0
* progress >= 1.6
* reportlab >= 4.3

## Install ##
```
pip install soup
```

## Notes ##
### Good Usage ###

The input should consist of a pandas dataframe with column names that correspond to those specified in the config file. Several considerations should be taken into account:

* Synchronization of Features: All features must be synchronized for proper usage, ensuring consistency across the dataset.

* Stage Labeling Consistency: Stage labeling must align with the specifications provided in the config file. It is essential to use consistent stage labels to avoid misinterpretation of results.

* Clinical Dissemination: The user can perform a dissemination of the results based on clinical information. This, should be a dataframe containing a column named `id', which matches the identifiers in the input data. Additionally, the remaining columns of this dataframe will be automatically analyzed based on their values.
\end{itemize}


### Scalability ###

`config` file has been implemented. This feature empowers both users and developers to effortlessly expand the tool's capabilities by incorporating new conditions and signals from the state-of-the-art literature.

The `config.py` file facilitates the inclusion of new conditions for existing signals and the addition of entirely new signals for analysis. An example of the configuration structure for AC signal is:

```
AC_CONFIG = {
   'rel_cols': ['AC', 'Stage', 'id'],
   'conditions': {
      'ac_n1_highest': { 
            'description': 'ACC in the N1 stage are higher than in others',
            'alpha': 0.05, 
            'generate':{
                'operation': 'max',
                'column': 'AC', 
                'stage': 'N1',
                'stage2compare': '',
                'stages2ignore':['AWAKE'],
                'groupby':'',
            }
        },
        'ac_nrem_less_freq_awake': { 
            'description': 'ACC smaller and less frequen when sleep deepens',
            'alpha': 0.05
        },
      # Additional conditions can 
      # be added here...
}
```

Below is an explanation of the provided configuration:

* rel_cols: Specifies the relevant columns to be used in the analysis. In this case, ['AC', 'Stage', 'id'] are the columns considered.

* conditions: A dictionary where each key represents a specific condition to be analyzed. Each condition includes various parameters:

   * description: Optional, includes a description of the condition and references to find it in the literature.
   * alpha: 0.05 - The significance level for statistical testing.
   * generate: When the condition is not implemented in the code, it can be automatically generated by including this nested dictionary. It must include with details on how to generate the necessary data for this condition: 
      * operation: The operation to perform on the specified column. Options: 'min','max','diff'.
      * column: The column on which the operation is performed.
      * stage: The stage of interest for the operation.
      * stage2compare: String, indicates a specific sleep stage to compare. In the previous example is an empty string because a set of sleep stages are compared. 
      * stages2ignore: List of strings. Stages to ignore during the analysis, in this case, the 'AWAKE' stage.
      * groupby: String. Indicates if the sleep stages should be group by certain criteria. Options: 
         * 'light': N2 and N1 are combined with N1.
         * 'ns': NREM (N2, N1 and N3) stages are grouped as N1
         * 'all': All stages (except awake) are combined with N1


Additional conditions can be added to the conditions dictionary following the same structure as the examples provided.

Additionally, the `config` file provides flexibility in specifying the encoding scheme for each sleep stage. Currently, the following codification is employed:

```
STAGES = {
   'N1': 1,
   'N2': 2,
   'N3': 3,
   'REM': 4,
   'AWAKE': 5
}
```

By default, the tool uses the `config` file provided by the tool. However, it is possible to create a new one by following the instructions provided above and use the new configuration file instead.



## License ##
This project is licensed under the MIT License - see the [LICENSE](LICENSE.txt) file for details.

© 2024 Eesy-Innovation GmbH

## Citation ## 

* .